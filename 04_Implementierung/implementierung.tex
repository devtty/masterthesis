\chapter{Implementierung}

\anno{max. 5 Seiten} %Ref hat 12

% Was lesen wir in diesem Kapitel?
% Warum muss ich das als Gutachter lesen
% Wie verknüpft sich der Inhalt mit dem vorhergehenden Kapitel?
% Welche Implmentierungsentscheidungen? Welche Alternativen? Vor- und Nachteile des eigenen Ansatzes?

% Highlight 1 der Implementierung
Wie bereits in Abschnitt \ref{sec:Probleme} angemerkt sind offene Implementationen von Web Application Firewalls eher die Ausnahme und selbst Umsetzungen der in Abschnitt \ref{sec:relatedwork} erwähnten Produkte sind praktisch nicht auffindbar. In diesem Kapitel gibt es einen kurzen Überblick wie die Vorschläge aus dem vorhergehenden Kapitel dennoch praktisch umgesetzt werden können.

Eine komplette Umsetzung ohne vorherige Basis wäre zeitlich (von einer einzelnen Person) nicht umsetzbar gewesen, daher sollte ein vorhandenes Open Source Produkt entsprechend erweitert werden. Bei der Auswahl wurden zuerst die zwei (leichtgewichtigen) Lösungen \emph{OWASP ESAPIFilter}\footnote{\url{https://owasp.org/www-project-enterprise-security-api/} abgerufen am 05.07.2023} und {SpringSecurity HttpFirewall}\footnote{\url{https://docs.spring.io/spring-security/reference/servlet/exploits/firewall.html} abgerufen am 05.07.2023} betrachtet. Beide Produkte verstehen sich als Ausgangsbasis für die Entwicklung sicherheitsrelevanter HTTP-(Servlet)-Filter auf Anwendungsebene, sämtliche Funktionalität muß jedoch vom Nutzer erst implementiert werden. Bei der Nutzung wäre ein erhöhter Arbeitsaufwand absehbar. Diogo Sampaio und Jorge Bernardino verglichen 2017 verfügbare WAFs die ebenfalls als Erweiterungskandidaten in Frage kamen (siehe Tabelle \ref{tab:my_vergos}).

% Tabelle ggf. in Anhang verschieben

\begin{table}[h]
  \centering
  \begin{tabular}{|c | c | c | c |} 
    \hline
    & \textbf{ModSecurity} & \textbf{WebCastellum} & \textbf{IronBee} \\ [0.5ex] 
    \hline
    Simple filtering & Yes & Yes & Yes \\ 
    \hline
    Regular expression based filtering & Yes &  & Yes \\
    \hline
    Auditing & Yes &  & Yes \\
    \hline
    Null byte attack prevention & Yes & Yes &  \\
    \hline
    URL Encryption & Yes & Yes &  \\ [1ex] 
    \hline
    Stateful Attack Detection & & Yes & Yes \\
    \hline
  \end{tabular}
  \caption{Vergleich Open Source Web Application Firewalls (aus \cite{Sampaio2017}) }
  \label{tab:my_vergos}
\end{table}

\emph{ModSecurity} und \emph{IronBee} Stärken liegen in der regelbasierten Auswertung (\emph{regular expression based filtering}). Beide werden als Reverse-Proxy vor der eigentlichen Anwendung eingesetzt und sind keine HTTP-Servlet-Filter. Dies hat den Nachteil das kein Zugriff auf die eigentlichen Anwendungsdaten besteht und nur anhand des HTTP-Datenverkehrs gefiltert werden kann. \emph{WebCastellum} scheint hier Gutes aus beiden Welten bereit zustellen, zum einen (als Servlet-Filter) direkten Zugriff auf die Anwendungsdaten, als auch regelbasiertes Filtern \emph{out-of-the-box}. \anno{Achtung! Sampaios Tabelle ist hier fehlerhaft! Übernehmen trotz Fehler?} 





Als Grundlage für die Implementierung der Firewall-Funktionalität wurde mit der Software \emph{WebCastellum} eine etwas ältere Implementierung eines Servlet-Filters gewählt.

\section{Vorarbeiten}

\begin{figure}[h]
  \centering
  \begin{gnuplot}[terminal=png,scale=.7]
    set datafile separator ','
    set xdata time
    set timefmt "%Y-%m"
    set xrange ["2009-01":"2022-04"]
    set format x "%b %y"
    set key autotitle columnhead
    plot '04_Implementierung/downloads.csv' using 1:2 with boxes fs solid 1.0 fc 'steelblue'
  \end{gnuplot}
  \caption{Downloads Statistics WebCastellum 1.8.3 binary}
  \label{fig:downloadwc}
\end{figure}
  
\subsection{Review Quellcode und IT-Sicherheit}
\subsection{Unit-Tests etc.}
\subsection{Fehlerbereinigung}

% Highlight 2 der Implementierung
\section{Zentralisierung}
\begin{figure}[ht]
    \centering
    \includegraphics[width=8cm]{central.png}
    \caption{Arbeit der WAFs im Verbund}
    \label{fig:my_verbund}
\end{figure}

\begin{figure}[bht]
  \begin{center}
    \includegraphics[width=12cm]{classp}
    \caption{Implementierung Nachrichtenversand}
    \label{fig.impversand}
  \end{center}
\end{figure}

\begin{figure}[h]
  \begin{center}
    \includegraphics[width=14cm]{configclasses}
    \caption{Implementierung Konfiguration}
    \label{fig.impkonfig}
  \end{center}
\end{figure}



\section{ML-Fähigkeit}

\begin{figure}[h]
    \centering
    \includegraphics[width=9cm]{webcastellumcentral.png}
    \caption{Komponentendiagramm für zentrale Klassifizierung}
    \label{fig:my_future}
\end{figure}


% Highlight des Deployments beim Kunden

% Zusammenfassung: ca. 0,5 Seiten
\section{Zusammenfassung}

% Was haben wir in diesem Kapitel gelernt?
% Wie passt das zur Zielstellung der Arbeit?
% Wie passt das zum nächsten Kapitel?